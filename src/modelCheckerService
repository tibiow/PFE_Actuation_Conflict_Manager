[{"id":"bbe34270.ed0d8","type":"subflow","name":"SCXML->SMV","info":"","category":"","in":[{"x":40,"y":160,"wires":[{"id":"277320fd.f7f08"}]}],"out":[{"x":1140,"y":160,"wires":[{"id":"ed9b0686.62c928","port":0}]}]},{"id":"ed9b0686.62c928","type":"function","z":"bbe34270.ed0d8","name":"from scxml to smv","func":"var init = msg.payload.scxml.$.initial;\nvar states = [];\nvar transitions = [];\nfor (var i = 0; i < msg.payload.scxml.state.length; i++) {\n    var currentState = msg.payload.scxml.state[i].$.id\n    states.push(currentState);\n    var transitionLength;\n    if (msg.payload.scxml.state[i].transition != null) {\n        transitionLength = msg.payload.scxml.state[i].transition.length\n    }else{\n        transitionLength = 0;\n    }\n    for (var j = 0; j < transitionLength; j++) {\n        var transitionAttribute = msg.payload.scxml.state[i].transition[j].$;\n        var currentTransition = [currentState, transitionAttribute.event,transitionAttribute.target];\n        transitions.push(currentTransition);\n    }\n    \n}\n\nmsg.payload = \"MODULE main \\n\\tVAR\\n\\t\\tstate : {\"\nvar listStates = \"\";\nfor (var i = 0; i < states.length; i++) {\n    if(i !== 0){\n       listStates = listStates + \",\" ;\n    }\n    listStates = listStates + states[i];\n}\n\nmsg.payload = msg.payload + listStates;\n\nmsg.payload = msg.payload + \"};\\n\tASSIGN\\n\\t\\tinit(state) := \";\nmsg.payload = msg.payload + init+\";\";\nmsg.payload = msg.payload + \"\\n\\t\\tnext(state) := \\n\\t\\t\\tcase\\n\";\n\n//for to create all the conditions\nfor (var i = 0; i < transitions.length; i++) {\n    msg.payload = msg.payload + \"\\t\\t\\t\\tstate = \" + transitions[i][0] + \" : \" + transitions[i][2]+\";\\n\";\n}\n\nmsg.payload = msg.payload + \"\\t\\t\\t\\tTRUE : {\" +listStates + \"};\\n\\t\\t\\tesac;\\n\";\n\n\nreturn msg; ","outputs":1,"noerr":0,"x":490,"y":160,"wires":[[]]},{"id":"277320fd.f7f08","type":"xml","z":"bbe34270.ed0d8","name":"","property":"payload","attr":"","chr":"","x":310,"y":160,"wires":[["ed9b0686.62c928"]]},{"id":"f3951f17.16e13","type":"subflow","name":"Model Checker","info":"","category":"","in":[{"x":100,"y":220,"wires":[{"id":"fd559e2a.1a2cf"}]}],"out":[{"x":2760,"y":360,"wires":[{"id":"796e4d32.8d4e94","port":0},{"id":"e9886db6.9c093","port":0},{"id":"798015dc.a5e4fc","port":0}]},{"x":1900,"y":140,"wires":[{"id":"31a8a33f.2ec00c","port":1}]}]},{"id":"31a8a33f.2ec00c","type":"exec","z":"f3951f17.16e13","command":"./NuSMV /tmp/file.smv","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1660,"y":80,"wires":[["9ead5da2.4328c"],["4e1c55f0.692b0c"],[]]},{"id":"7af59a25.3eead4","type":"comment","z":"f3951f17.16e13","name":"launch tests","info":"","x":550,"y":20,"wires":[]},{"id":"1c5e70f6.38f35f","type":"comment","z":"f3951f17.16e13","name":"add a test","info":"","x":580,"y":160,"wires":[]},{"id":"3a8b6896.7656d8","type":"function","z":"f3951f17.16e13","name":"add test to tab 'tests'","func":"var tests = flow.get('tests') || [];\ntests.push(msg.payload);\nflow.set('tests',tests);\nmsg.payload = tests;\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":220,"wires":[["96796424.c54228"]]},{"id":"96796424.c54228","type":"debug","z":"f3951f17.16e13","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":850,"y":220,"wires":[]},{"id":"87ac443d.b38368","type":"comment","z":"f3951f17.16e13","name":"reset tests","info":"","x":580,"y":280,"wires":[]},{"id":"b647bb4c.1496c8","type":"function","z":"f3951f17.16e13","name":"clean 'tests' tab","func":"var tests = flow.get('tests') || [];\ntests.pop();\nflow.set('tests',tests);\nmsg.payload = tests;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":340,"wires":[["d2567b98.a0dc68"]]},{"id":"d2567b98.a0dc68","type":"debug","z":"f3951f17.16e13","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":780,"y":340,"wires":[]},{"id":"a81c6559.6b8f68","type":"file","z":"f3951f17.16e13","name":"","filename":"/tmp/file.smv","appendNewline":false,"createDir":true,"overwriteFile":"true","x":910,"y":80,"wires":[["c074e5f.9a65818"]]},{"id":"53f8b623.1d9aa8","type":"function","z":"f3951f17.16e13","name":"get data","func":"var storageAddress = flow.get('storageAddress') || null;\n\nmsg.log = msg.payload.data.logFile\nmsg.fsm = storageAddress +\"storage?file=\"+ msg.payload.data.urlFSM\nmsg.test = storageAddress +\"storage?file=\"+ msg.payload.data.urlTest\n\nmsg.url = msg.fsm\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":80,"wires":[["22e70e8f.a958e2"]]},{"id":"fd559e2a.1a2cf","type":"switch","z":"f3951f17.16e13","name":"","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"launchTests","vt":"str"},{"t":"eq","v":"addTest","vt":"str"},{"t":"eq","v":"resetTests","vt":"str"},{"t":"eq","v":"saveTests","vt":"str"},{"t":"eq","v":"loadTests","vt":"str"},{"t":"eq","v":"setStorageAddress","vt":"str"},{"t":"eq","v":"setLocalAddress","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":190,"y":240,"wires":[["53f8b623.1d9aa8"],["e7c04183.8036b"],["b647bb4c.1496c8"],["f634308a.f482a"],["5ff9d6c0.533428"],["e9886db6.9c093"],["798015dc.a5e4fc"]]},{"id":"e7c04183.8036b","type":"function","z":"f3951f17.16e13","name":"get data","func":"msg.payload = msg.payload.data\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":220,"wires":[["3a8b6896.7656d8"]]},{"id":"66b1a3c.b262a5c","type":"function","z":"f3951f17.16e13","name":"savemodel","func":"msg.payload = \"{\\\"action\\\":\\\"saveModelLog\\\",\\\"data\\\":{\\\"logUrl\\\":\\\"http://localhost:1880/modelCheck?file=\"+msg.log+\"\\\",\\\"logFile\\\":\\\"\"+msg.log+\"\\\"}}\"\nreturn msg;","outputs":1,"noerr":0,"x":2410,"y":60,"wires":[["796e4d32.8d4e94"]]},{"id":"4e1c55f0.692b0c","type":"debug","z":"f3951f17.16e13","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1650,"y":180,"wires":[]},{"id":"3e6efa0c.bd5ab6","type":"function","z":"f3951f17.16e13","name":"send url to file","func":"msg.payload = \"{\\\"action\\\":\\\"saveTests\\\",\\\"data\\\":{\\\"urlFrom\\\":\\\"http://localhost:1880/modelCheck?file=\"+ msg.name +\"\\\",\\\"name\\\":\\\"\"+msg.name+\"\\\"}}\"\nreturn msg;","outputs":1,"noerr":0,"x":1060,"y":440,"wires":[["796e4d32.8d4e94"]]},{"id":"8ee78c63.c37b7","type":"comment","z":"f3951f17.16e13","name":"save tests","info":"","x":380,"y":400,"wires":[]},{"id":"6ea1ad60.63a0c4","type":"comment","z":"f3951f17.16e13","name":"load tests","info":"","x":380,"y":580,"wires":[]},{"id":"54ff7d5d.ba6a84","type":"function","z":"f3951f17.16e13","name":"send reply","func":"msg.payload = \"{\\\"reply\\\" : \\\"log\\\",\\\"data\\\" : \\\"model check tests from \"+ msg.url +\"successfully loaded\\\"}\"\nreturn msg;","outputs":1,"noerr":0,"x":1150,"y":620,"wires":[["796e4d32.8d4e94"]]},{"id":"e221b7ad.c328e8","type":"function","z":"f3951f17.16e13","name":"export string to \"tests\" variable","func":"var tests = flow.get('tests') || [];\ntests = msg.payload.split(\"\\n\")\nmsg.payload = tests\nflow.set('tests',tests);\nreturn msg","outputs":1,"noerr":0,"x":830,"y":620,"wires":[["54ff7d5d.ba6a84","23b4a73b.e7c488"]]},{"id":"23b4a73b.e7c488","type":"debug","z":"f3951f17.16e13","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1150,"y":700,"wires":[]},{"id":"796e4d32.8d4e94","type":"json","z":"f3951f17.16e13","name":"","property":"payload","action":"","pretty":false,"x":2670,"y":260,"wires":[[]]},{"id":"6c3b77a5.24ced8","type":"subflow:bbe34270.ed0d8","z":"f3951f17.16e13","name":"","x":720,"y":80,"wires":[["a81c6559.6b8f68"]]},{"id":"f634308a.f482a","type":"function","z":"f3951f17.16e13","name":"get and save data ","func":"var tests = flow.get('tests') || [];\n\nmsg.name = msg.payload.data.name\nmsg.filename = \"/tmp/modelCheck/\"+msg.payload.data.name\nmsg.payload = \"\"\nfor (var i = 0; i < tests.length; i++) {\n    msg.payload += tests[i] + \"\\n\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":440,"wires":[["e148c0a0.f88db"]]},{"id":"e148c0a0.f88db","type":"file","z":"f3951f17.16e13","name":"","filename":"","appendNewline":true,"createDir":true,"overwriteFile":"true","x":610,"y":440,"wires":[["3e6efa0c.bd5ab6"]]},{"id":"5ff9d6c0.533428","type":"function","z":"f3951f17.16e13","name":"get data","func":"msg.url = msg.payload.data.urlFrom\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":620,"wires":[["6a372a19.6a1284"]]},{"id":"6a372a19.6a1284","type":"http request","z":"f3951f17.16e13","name":"","method":"GET","ret":"txt","url":"","x":570,"y":620,"wires":[["e221b7ad.c328e8"]]},{"id":"22e70e8f.a958e2","type":"http request","z":"f3951f17.16e13","name":"","method":"GET","ret":"txt","url":"","tls":"","x":530,"y":80,"wires":[["6c3b77a5.24ced8"]]},{"id":"c074e5f.9a65818","type":"function","z":"f3951f17.16e13","name":"change url","func":"msg.url = msg.test\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":80,"wires":[["cfb64487.36b7c8"]]},{"id":"cfb64487.36b7c8","type":"http request","z":"f3951f17.16e13","name":"","method":"GET","ret":"txt","url":"","x":1270,"y":80,"wires":[["4ca68720.2a3a18","1ceab846.f53fa8"]]},{"id":"4ca68720.2a3a18","type":"file","z":"f3951f17.16e13","name":"","filename":"/tmp/file.smv","appendNewline":false,"createDir":true,"overwriteFile":"false","x":1450,"y":80,"wires":[["31a8a33f.2ec00c"]]},{"id":"9ead5da2.4328c","type":"function","z":"f3951f17.16e13","name":"save log","func":"var storageAddress = flow.get('storageAddress') || null;\nvar localAddress = flow.get('localAddress') || null;\n\n\nmsg.filename = \"/tmp/modelCheck/\"+msg.log\nmsg.url = storageAddress + \"storage/saveSimLog?logUrl=\"+localAddress+\"modelCheck?file=\"+msg.log+\"&logFile=\"+msg.log\n\nreturn msg;","outputs":1,"noerr":0,"x":1900,"y":60,"wires":[["589cb34b.01f94c"]]},{"id":"589cb34b.01f94c","type":"file","z":"f3951f17.16e13","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":2050,"y":60,"wires":[["bcc16deb.04f92"]]},{"id":"e9886db6.9c093","type":"function","z":"f3951f17.16e13","name":"remember address storage","func":"var storageAddress = flow.get('storageAddress') || null;\n\nstorageAddress = msg.payload.data.address\nflow.set(\"storageAddress\",storageAddress)\nmsg.payload = storageAddress\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":740,"wires":[["adf3b90e.e4b848"]]},{"id":"adf3b90e.e4b848","type":"debug","z":"f3951f17.16e13","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":670,"y":780,"wires":[]},{"id":"798015dc.a5e4fc","type":"function","z":"f3951f17.16e13","name":"remember address storage","func":"var localAddress = flow.get('localAddress') || null;\n\nlocalAddress = msg.payload.data.address\nflow.set(\"localAddress\",localAddress)\nmsg.payload = localAddress\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":840,"wires":[["2c91af42.393b8"]]},{"id":"2c91af42.393b8","type":"debug","z":"f3951f17.16e13","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":670,"y":880,"wires":[]},{"id":"bcc16deb.04f92","type":"http request","z":"f3951f17.16e13","name":"","method":"GET","ret":"txt","url":"","x":2230,"y":60,"wires":[["66b1a3c.b262a5c"]]},{"id":"1ceab846.f53fa8","type":"debug","z":"f3951f17.16e13","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1430,"y":180,"wires":[]},{"id":"11ee5578.04523b","type":"tab","label":"ModelChecker service","disabled":false,"info":""},{"id":"d28043c9.b5b33","type":"http response","z":"11ee5578.04523b","name":"","statusCode":"","headers":{},"x":1030,"y":180,"wires":[]},{"id":"4fcb728f.42688c","type":"http in","z":"11ee5578.04523b","name":"","url":"/modelCheck/","method":"get","upload":false,"swaggerDoc":"","x":270,"y":180,"wires":[["93f7ab51.7b8da8"]]},{"id":"93f7ab51.7b8da8","type":"function","z":"11ee5578.04523b","name":"","func":"msg.filename = \"/tmp/modelCheck/\" + msg.req.query.file\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":180,"wires":[["84957c.9f9f5a88"]]},{"id":"84957c.9f9f5a88","type":"file in","z":"11ee5578.04523b","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"x":830,"y":180,"wires":[["d28043c9.b5b33"]]},{"id":"13c000aa.21ac9f","type":"http response","z":"11ee5578.04523b","name":"","statusCode":"","headers":{},"x":1070,"y":280,"wires":[]},{"id":"ecac5c27.3828b","type":"http in","z":"11ee5578.04523b","name":"","url":"/modelCheck/launchTests","method":"get","upload":false,"swaggerDoc":"","x":310,"y":280,"wires":[["12bf9e46.f6a822"]]},{"id":"12bf9e46.f6a822","type":"function","z":"11ee5578.04523b","name":"","func":"msg.payload.action = \"launchTests\"\nmsg.payload.data = {}\nmsg.payload.data.urlTest = msg.req.query.urlTest\nmsg.payload.data.urlFSM = msg.req.query.urlFSM\nmsg.payload.data.logFile = msg.req.query.logFile\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":280,"wires":[["c56f125b.07bc1"]]},{"id":"b7508241.d5b5d","type":"comment","z":"11ee5578.04523b","name":"modelCheck","info":"","x":250,"y":140,"wires":[]},{"id":"f436f2b9.8be3e","type":"debug","z":"11ee5578.04523b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1090,"y":360,"wires":[]},{"id":"c56f125b.07bc1","type":"subflow:f3951f17.16e13","z":"11ee5578.04523b","name":"","x":800,"y":280,"wires":[["13c000aa.21ac9f","f436f2b9.8be3e"],[]]},{"id":"8fc0dc05.7b341","type":"http in","z":"11ee5578.04523b","name":"","url":"/modelCheck/setStorageAddress","method":"get","upload":false,"swaggerDoc":"","x":290,"y":400,"wires":[["4ee20649.167f98"]]},{"id":"4ee20649.167f98","type":"function","z":"11ee5578.04523b","name":"","func":"msg.payload.action = \"setStorageAddress\"\nmsg.payload.data = {}\nmsg.payload.data.address = msg.req.query.address\n\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":400,"wires":[["c56f125b.07bc1"]]},{"id":"2a7dfaf1.e8f9b6","type":"http in","z":"11ee5578.04523b","name":"","url":"/modelCheck/setLocalAddress","method":"get","upload":false,"swaggerDoc":"","x":300,"y":480,"wires":[["b52ff737.fbfb58"]]},{"id":"b52ff737.fbfb58","type":"function","z":"11ee5578.04523b","name":"","func":"msg.payload.action = \"setLocalAddress\"\nmsg.payload.data = {}\nmsg.payload.data.address = msg.req.query.address\n\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":480,"wires":[["c56f125b.07bc1"]]}]
