[{"id":"2a6a19aa.803916","type":"function","z":"a215432.6282cc","name":"merge two","func":"var system = flow.get('system') || [];\nvar new_system = []\n\n\nfor (var i = 0; i < system[0].length; i++) {\n    for (var j = 0; j < system[1].length; j++) {\n        var stateName = system[0][i].stateName +\"-\"+ system[1][j].stateName\n        var new_state = JSON.parse(\"{\\\"stateName\\\":\\\"\"+stateName+\"\\\",\\\"transitions\\\":[]}\")\n        for (var k = 0; k < system[0][i].transitions.length; k++) {\n            var event = system[0][i].transitions[k].event\n            var destination = system[0][i].transitions[k].destination + \"-\" +  system[1][j].stateName//add current j state name\n            //add transition\n            var new_transition = JSON.parse(\"{\\\"event\\\":\\\"\"+event+\"\\\",\\\"destination\\\":\\\"\"+destination+\"\\\"}\")\n            new_state.transitions.push(new_transition)\n        }\n        for (var k = 0; k < system[1][j].transitions.length; k++) {\n            var event = system[1][j].transitions[k].event\n            var destination = system[0][i].stateName +\"-\"+ system[1][j].transitions[k].destination   //add current i state name\n            //add transition\n            var new_transition = JSON.parse(\"{\\\"event\\\":\\\"\"+event+\"\\\",\\\"destination\\\":\\\"\"+destination+\"\\\"}\")\n            new_state.transitions.push(new_transition)\n        }\n        //add complete State\n        new_system.push(new_state)\n    }\n}\nmsg.payload = new_system\n//flow.setFlow('system',system)\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":320,"wires":[["28acdf81.17147"]]}]
